---
title: CentOS 上部署 MySQL5.7.17 二进制安装
author: starifly
date: 2019-09-22T21:22:23+08:00
categories: [mysql]
tags: [mysql,数据库,centos]
draft: true
slug: MySQL5.7.17-binary-installation-on-centos
---

## 建用户、下载、解压

```shell
groupadd mysql
useradd -r -g mysql mysql
wget http://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-5.7.17-linux-glibc2.5-x86_64.tar.gz
tar xvf mysql-5.7.17-linux-glibc2.5-x86_64.tar.gz -C /usr/local/ 
ln -sv /usr/local/mysql-5.7.17-linux-glibc2.5-x86_64 /usr/local/mysql
```

## 输出环境变量、帮助

```shell
/etc/profile
export PATH=$PATH:/usr/local/mysql/bin
source /etc/profile
vim /etc/man.config
MANPATH /usr/local/mysql/man
```

## 初始化

创建数据目录、授权、初始化mysql mysql5.7.7及以上做了很多改变，5.7.7以前安装方法和以前差不多，初始化也保留了mysql_install_db，5.7.7以后则去掉了该脚本，使用了-initialize 或者 --initialize-insecure 参数作为初始化。

 mysql5.7.14版本初始化时候已经抛弃了defaults-file参数文件，所以在初始化时候指定配置文件会出错，同时必须保证datadir为空。

```shell
mkdir /data/mysql
chown mysql.mysql /data/mysql
mysqld --verbose --help |more 查看更多初始化参数
/usr/local/mysql/bin/mysqld --initialize-insecure --user=mysql --basedir=/usr/local/mysql --datadir=/data/mysql
```

 初始化成功了。这里说明下，初始化参数我使用了--initialize-insecure，这样不会设置初始化root密码，如果是 --initialize的话，会随机生成一个密码：

 ## 设置加密连接

 ```shell
 mysql_ssl_rsa_setup
 ```

 ## 复制配置文件和启动脚本

```shell
cp /usr/local/mysql/support-files/my-default.cnf /etc/my.cnf
cp /usr/local/mysql/support-files/mysql.server /etc/init.d/mysqld
```

配置如下：

```conf
# For advice on how to change settings please see
# http://dev.mysql.com/doc/refman/5.7/en/server-configuration-defaults.html
# *** DO NOT EDIT THIS FILE. It's a template which will be copied to the
# *** default location during install, and will be replaced if you
# *** upgrade to a newer version of MySQL.
[mysqld]
# Remove leading # and set to the amount of RAM for the most important data
# cache in MySQL. Start at 70% of total RAM for dedicated server, else 10%.
# innodb_buffer_pool_size = 128M
# Remove leading # to turn on a very important data integrity option: logging
# changes to the binary log between backups.
# log_bin
# These are commonly set, remove the # and set as required.
basedir=/usr/local/mysql
datadir=/data/mysql
port=3306
server_id=1
socket=/data/mysql/mysql.sock
symbolic-links=0
character_set_server=utf8
# Remove leading # to set options mainly useful for reporting servers.
# The server defaults are faster for transactions and fast SELECTs.
# Adjust sizes as needed, experiment to find the optimal values.
# join_buffer_size = 128M
# sort_buffer_size = 2M
# read_rnd_buffer_size = 2M 
sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES 
[client]
socket=/data/mysql/mysql.sock
```

## 启动并加入开机服务

```shell
/etc/init.d/mysqld start
/etc/init.d/mysqld restart
chkconfig --add mysqld
chkconfig mysqld on
chkconfig --list mysqld    <===确认
```

## 修改密码并授权远程访问

```shell
mysqladmin -u root password 'root'
mysqladmin -uroot -proot password 'root@root'
mysql -uroot -proot@root
mysql> grant all privileges  on *.* to root@'%' identified by "root@root";
mysql> flush privileges;
mysql> \q
```

## Reference

- [CentOS6.5 上部署 MySQL5.7.17 二进制安装以及多实例配置](https://www.jb51.net/article/103843.htm)
